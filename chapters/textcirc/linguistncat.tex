\section{An introduction to weak n-categories for formal linguists}\label{sec:weakn}

Geometrically, a set is a collection of labelled zero-dimensional points. A category is a collection of one-dimensional labelled arrows upon a set of zero-dimensional points (that satisfy certain additional conditions, such as having identity morphisms and associativity of composition.) Naturally, we might ask what happens when we generalise to more dimensions, asking for two-dimensional somethings going between one-dimensional arrows, and three-dimensional somethings going between two-dimensional somethings, and so on. This is the gist of an $n$-category, where $n$ is a positive integer denoting dimension. Different choices of what n-dimensional somethings could be give different conceptions of $n$-category, because there are multiple mathematically well-founded choices for filling in the blank of \texttt{points, lines, ???}. Simplices, cubical sets, and globular sets are three common options; though the names are fancy, they correspond to triangular, cubical, and circular families of objects indexed by dimension.\\

In regular or 1-category theory we are interested in objects up to isomorphism rather than equality - because isomorphic objects are as good as one another.
Concretely, two objects $X$ and $Y$ are isomorphic when there exist morphisms $f : X \rightarrow Y$ and $g : Y \rightarrow X$ such that $g \circ f = 1_X$ and $f \circ g = 1_Y$. Lifting this philosophy to n-categories, we can replace equalities $f = g$ of $k$-morphisms (for $k < n$) with $(k + 1)$-isomorphisms $f \simeq g$. This extends also to the equalities in the definition of a $(k + 1)$-isomorphism, all the way up to dimension $n$ at which point we are content with ordinary equality again. The idea of replacing equality with isomorphism can even extend to the associativity, unitality and interchange laws governing the composition operations. If left to be ordinary equalities, we speak of a \emph{strict} $n$-category. If only witnessed by a coherent system of isomorphisms, we have a \emph{weak} $n$-category. Unsurprisingly the weak variant is much harder to formalise, but also much more expressive once n > 2.\\

Mathematicians, computer scientists, and physicists may have good reasons to work with $n$-categories \citep{baez_introduction_1997}, but what is the value proposition for formal linguists? A practical draw for the formal syntactician is that weak $n$-categories provide a natural setting to model generic rewriting systems, and that is what we will focus on here. Here, we work with a semi-strict model in which associativity and unitality remain strict, while interchange is weak. This fact is hidden behind a convenient graphical notation, and we do not miss out on any of the expressivity of fully weak higher categories. Additionally, this system has an online proof assistant \texttt{homotopy.io}. For formal details the reader is referred to \citep{nlab_authors_homotopyio_nodate,dorn_associative_2023,reutter_high-level_2019,heidemann_zigzag_2022}. In this setting we will demonstrate how weak $n$-categories provide a common setting to formalise string-rewrite and tree-adjoining grammars, setting the stage for us to specify a circuit-adjoining grammar for text circuits later on.

\newpage

\subsection{String-rewrite systems as 1-object-2-categories}

\begin{marginfigure}
\centering
\[\tikzfig{ncat/flower1}\]
\caption{The category in question can be visualised as a commutative diagram.}
\end{marginfigure}

\begin{marginfigure}
\centering
\[\resizebox{\textwidth}{!}{\tikzfig{ncat/table1}}\]
\caption{When there are too many generating morphisms, we can instead present the same data as a table of $n$-cells; there is a single 0-cell $\star$, and three non-identity 1-cells corresponding to $\textcolor{green}{\alpha}, \textcolor{orange}{\beta}, \textcolor{cyan}{\gamma}$, each with source and target 0-cells $\star$. Typically identity morphisms can be omitted from tables as they come for free. Observe that composition of identities enforces the behaviour of the empty string, so that for any string $x$, we have $\epsilon \cdot x = x = \epsilon \cdot x$.}
\end{marginfigure}

\begin{marginfigure}
\centering
\[\resizebox{\textwidth}{!}{\tikzfig{ncat/cstring1}}\]
\caption{For a concrete example, we can depict the string $\textcolor{green}{\alpha} \cdot \textcolor{cyan}{\gamma} \cdot \textcolor{cyan}{\gamma} \cdot \textcolor{orange}{\beta}$ as a morphism in a commuting diagram.}
\end{marginfigure}

\begin{marginfigure}
\centering
\[\tikzfig{ncat/string1}\]
\caption{The string-diagrammatic view, where $\star$ is treated as a wire and morphisms are treated as boxes or dots is an expression of the same data under the Poincar\'{e} dual.}
\end{marginfigure}

\begin{marginfigure}\label{fig:ruleR}
\centering
\[\resizebox{0.75\textwidth}{!}{\tikzfig{ncat/poindual}}\]
\caption{We can visualise the rule as a commutative diagram where $\textcolor{magenta}{R}$ is a 2-cell between the source and target 1-cells. Just as 1-cells are arrows between 0-cell points in a commuting diagram, a 2-cell can also be conceptualised as a directed surface from a 1-cell to another. Taking the Poincar\'{e} dual of this view gives us a string diagram for the 2-cell $\textcolor{magenta}{R}$.}
\end{marginfigure}

\begin{marginfigure}\label{fig:cfgsig}
\centering
\[\resizebox{0.75\textwidth}{!}{\tikzfig{tree2gate/cfg/cfgsignature}}\]
\caption{We can describe a context-free grammar with the same combinatorial rewriting data that specifies planar string diagrams as we have been illustrating so far. Here is a context-free grammar for \texttt{Alice sees Bob quickly run to school}.
}
\end{marginfigure}

Say we have an alphabet $\Sigma := \{\textcolor{green}{\alpha}, \textcolor{orange}{\beta}, \textcolor{cyan}{\gamma}\}$. Then the Kleene-star $\Sigma^*$ consists of all strings (including the empty string $\varepsilon$) made up of $\Sigma$, and we consider formal languages on $\Sigma$ to be subsets of $\Sigma^*$. Another way of viewing $\Sigma^*$ is as the free monoid generated by $\Sigma$ under the binary concatenation operation $(\_ \ \cdot \ \_)$ which is associative and unital with unit $\varepsilon$, the empty string. Associativity and unitality are precisely the conditions of composition of morphisms in categories, so we have yet another way to express $\Sigma^*$ as a finitely presented category; we consider a category with a single object $\star$, taking $\varepsilon$ to be the identity morphism $\textbf{1}_\star$ on the single object, and we ask for the category obtained when we consider the closure under composition of three non-identity morphisms $\textcolor{green}{\alpha}, \textcolor{orange}{\beta}, \textcolor{cyan}{\gamma}: \star \rightarrow \star$. In this category, every morphism $\star \rightarrow \star$ corresponds to a string in $\Sigma^*$. We illustrate this example in the margins. A string-rewrite system additionally consists of a finite number of string-transformation rules. Building on our example, we might have a named rule $\textcolor{magenta}{R}: \textcolor{green}{\alpha} \mapsto \textcolor{orange}{\beta} \cdot \textcolor{cyan}{\gamma}$, which we illustrate in Figure \ref{fig:ruleR}.\\

\newthought{We consider rewrites to be equivalent, but not equal.} In a string-rewrite system, rewrites are applied one at a time. This means that even for our simple example, there are two possible rewrites from $\textcolor{green}{\alpha} \cdot \textcolor{green}{\alpha}$ to obtain $\textcolor{orange}{\beta} \cdot \textcolor{cyan}{\gamma} \cdot \textcolor{orange}{\beta} \cdot \textcolor{cyan}{\gamma}$. Here are the two rewrites viewed in two equivalent ways, first on the left informally where strings are nodes in a graph and rewrites are labelled transitions and secondly on the right as two distinct commuting 2-diagrams.

\[\resizebox{0.8\textwidth}{!}{\tikzfig{ncat/2ways}}\]

What should we say about how these two different rewrites relate to each other? Let's say Alice is a formal linguist who is only interested in what strings are reachable from others by rewrites -- this is \emph{de rigeur} when we consider formal languages to be subsets of $\Sigma^*$. She might be happy to declare that these two rewrites are simply equal; categorically this is tantamount to her declaring that any two 2-cells in the 1-object-2-category that share the same source and target are in fact the same; between any such pair of 2-cells there is only one 3-cell, which is the identity. In fact, what Alice really cares to have is a category where the objects are strings from $\Sigma^*$, and the morphisms are a reachability relation by rewrites; this category is \emph{thin}, in that there is at most one arrow between each pair of objects, which forgets what rewrites are applied.

\[\tikzfig{ncat/thinalice}\]

Let's say Bob is a different sort of formal linguist who wants to model the two rewrites as nonequal but equivalent, with some way to keep track of how different equivalent rewrites relate to one another. Bob might want this for example because he wants to show that head-first rewrite strategies are the same as tail-first, so he wants to keep the observation that the two rewrites are equivalent in that they have the same source and target, while keeping the precise order of rewrites distinct. This order-independence of disjoint or non-interfering rewrites is reflected in the interchange law for monoidal categories, which in the case of our example is depicted as:

\[\tikzfig{ncat/bobfat}\]

In fact, Bob gets to express a new kind of rewrite in the middle: the kind where two non-conflicting rewrites happen \emph{concurrently}. The important aspect of Bob's view over Alice's is that equalities have been replaced by isomorphisms between syntactically inequal rewrites. In this case, the demotion of interchange equalities to isomorphisms means that Bob is dealing with a \emph{weak} 1-object-2-category (in general the demotion of equalities to isomorphisms is not synonymous to weakness.) Bob does have 3-cells that relate different 2-cells with the same source and target, but all of Bob's $n$-cells for $n \geq 3$ are equalities, rather than isomorphisms.


\newpage
\subsection{Tree Adjoining Grammars}

\marginnote{The essence of a tree-\emph{adjoining} grammar is as follows: whereas for a CFG one grows the tree by appending branches and leaves at the top of the tree (substitution), in a TAG one can also sprout subtrees from the middle of a branch (adjoining). Now we show that this gloss is more formal than it sounds, by the following steps. First we show that the 2-categorical data of a CFG can be transformed into 3-categorical data -- which we call \emph{Leaf-Ansatz} -- which presents a rewrite system that obtains the same sentences as the CFG, by a bijective correspondence between composition of 2-cells in the CFG and constructed 3-cells in the leaf-ansatz. These 3-cells in the leaf ansatz correspond precisely to the permitted \emph{substitutions} in a TAG. Then we show how to model \emph{adjoining} as 3-cells. Throughout we work with a running example, the CFG grammar introduced earlier. The main body covers the formal but unenlightening definition of \emph{elementary} tree adjoining grammars which we will convert to diagrams. We will deal with the extensions of links and local constraints to adjoining shortly.}

\begin{defn}[\emph{Elementary} Tree Adjoining Grammar: Classic Computer Science style]
An elementary \textbf{TAG} is a tuple
\[(\mathcal{N}, \mathcal{N}^\downarrow, \mathcal{N}^*, \Sigma, \mathcal{I}, \mathcal{A})\]
\end{defn}


The first four elements of the tuple are referred to as \emph{non-terminals}. They are:
	\begin{itemize}
			\item{A set of \emph{non-terminal symbols} $\mathcal{N}$ -- these stand in for grammatical types such as $\texttt{NP}$ and $\texttt{VP}$.}
			\item{A bijection $\downarrow: \mathcal{N} \rightarrow \mathcal{N}^\downarrow$ which acts as $\texttt{X} \mapsto \texttt{X}^\downarrow$. Nonterminals in $\mathcal{N}$ are sent to marked counterparts in $\mathcal{N}^\downarrow$, and the inverse sends marked nonterminals to their unmarked counterparts. These markings are \emph{substitution markers}, which are used to indicate when certain leaf nodes are valid targets for a substitution operation -- discussed later.}
			\item{A bijection $*: \mathcal{N} \rightarrow \mathcal{N}^*$ -- the same idea as above. This time to mark \emph{foot nodes} on auxiliary trees, which is structural information used by the adjoining operation -- discussed later.}
	\end{itemize}

$\Sigma$ is a set of \emph{terminal symbols} -- these stand in for the words of the natural language being modelled. $\mathcal{I}$ and $\mathcal{A}$ are sets of \emph{elementary trees}, which are either \emph{initial} or \emph{auxiliary}, respectively. \emph{Initial trees} satisfy the following constraints:

	\begin{itemize}
		\item{The interior nodes of an initial tree must be labelled with nonterminals from $\mathcal{N}$}
		\item{The leaf nodes of an initial tree must be labelled from $\Sigma \cup \mathcal{N}^{\downarrow}$}
	\end{itemize}
\emph{Auxiliary trees} satisfy the following constraints:
	\begin{itemize}
		\item{The interior nodes of an auxiliary tree must be labelled with nonterminals from $\mathcal{N}$}
		\item{Exactly one leaf node of an auxiliary tree must be labelled with a foot node $\texttt{X}^{*} \in \mathcal{N}^{*}$; moreover, this labelled foot node must be the marked counterpart of the root node label of the tree.}
		\item{All other leaf nodes of an auxiliary tree are labelled from $\Sigma \cup \mathcal{N}^{\downarrow}$}
	\end{itemize}

Further, there are two operations to build what are called \emph{derived trees} from elementary and auxiliary trees. \emph{Substitution} replaces a substitution marked leaf node $\texttt{X}^\downarrow$ in a tree $\alpha$ with another tree $\alpha'$ that has $\texttt{X}$ as a root node. \emph{Adjoining} takes auxiliary tree $\beta$ with root and foot nodes $\texttt{X},\texttt{X}^\star$, and a derived tree $\gamma$ at an interior node $\texttt{X}$ of $\gamma$. Removing the $\texttt{X}$ node from $\gamma$ separates it into a parent tree with an $\texttt{X}$-shaped hole for one of its leaves, and possibly multiple child trees with \texttt{X}-shaped holes for roots. The result of adjoining is obtained by identifying the root of $\beta$ with the $\texttt{X}$-context of the parent, and making all the child trees children of $\beta$'s foot node $\texttt{X}^\star$.

\newpage

\begin{figure}[h!]
\centering
\[\resizebox{0.75\textwidth}{!}{\tikzfig{tree2gate/tag/CFGtoTAGpattern}}\]
\caption{\begin{construction}[Leaf-Ansatz of a CFG]
Given a signature $\mathfrak{G}$ for a CFG, we construct a new signature $\mathfrak{G}'$ which has the same 0- and 1-cells as $\mathfrak{G}$. Now, referring to the dashed magenta arrows in the schematic below: for each 1-cell wire type $\texttt{X}$ of $\mathfrak{G}$, we introduce a \emph{leaf-ansatz} 2-cell $\texttt{X}^\downarrow$. For each leaf 2-cell $\texttt{X}_L$ in $\mathfrak{G}$, we introduce a renamed copy $\texttt{X}'_L$ in $\mathfrak{G}'$. Now refer to the solid magenta: we construct a 3-cell in $\mathfrak{G}'$ for each 2-cell in $\mathfrak{G}$, which has the effect of systematically replacing open output wires in $\mathfrak{G}$ with leaf-ansatzes in $\mathfrak{G}'$.
\end{construction}

\begin{proposition}\label{prop:cfgastag1}
Leaf-ansatzes of CFGs are precisely tree adjoining grammars (TAGs) with only initial trees and substitution.
\begin{proof}
By construction. Consider a CFG given by 2-categorical signature $\mathfrak{G}$, with leaf-ansatz signature $\mathfrak{G}'$. The types $\texttt{X}$ of $\mathfrak{G}$ become substitution marked symbols $\texttt{X}^{\downarrow}$ in $\mathfrak{G}'$. The trees $\texttt{X}_i$ in $\mathfrak{G}$ become initial trees $\texttt{X}^0$ in $\mathfrak{G}'$. The 3-cells $\texttt{X}_s$ of $\mathfrak{G}'$ are precisely substitution operations corresponding to appending the 2-cells $\texttt{X}_i$ of $\mathfrak{G}$.
\end{proof}
\end{proposition}
}
\end{figure}

\clearpage

The leaf-ansatz construction just makes formal the following observation: there are multiple equivalent ways of modelling terminal symbols in a rewrite system considered string-diagrammatically. So for a sentence like \texttt{Bob drinks}, we have the following derivations that match step for step in the two ways we have considered.

\begin{figure}
\centering
\[\resizebox{0.75\textwidth}{!}{\tikzfig{tree2gate/tag/leafansatzintuition}}\]
\caption{Instead of treating non-terminals as wires and terminals as effects (so that the presence of an open wire available for composition visually indicates non-terminality) the leaf-ansatz construction treats all symbols in a rewrite system as leaves, and the signature bookkeeps the distinction between nonterminals and terminals.}
\end{figure}

\begin{figure}
\[\resizebox{0.9\textwidth}{!}{\tikzfig{tree2gate/tag/3compareintuition}}\]
\caption{Adjoining is sprouting subtrees in the middle of branches. One way we might obtain the sentence \texttt{Bob runs to school} is to start from the simpler sentence \texttt{Bob runs}, and then refine the verb \texttt{runs} into \texttt{runs to school}. This refinement on part of an already completed sentence is not permitted in CFGs, since terminals can no longer be modified. The adjoining operation of TAGs gets around this constraint by permitting rewrites in the middle of trees.}
\end{figure}

\begin{figure}[h!]
\[\scalebox{0.6}{\tikzfig{tree2gate/tag/CFGasTAGsign}}\]
\caption{
Leaf-ansatz signature of \texttt{Alice sees Bob quickly run to school} CFG.\\

1-cells correspond to types. There are three kinds of 2-cells organised in rows; terminals, substitutable ans\"{a}tze that convert wires into bulbs; and the symbolic rewrites of CFGs respectively. There are two kinds of 3-cells similarly organised in rows; terminal-rewrites that replace a bulb with a terminal, and rewrites that mimic the CFG rewrites on ans\"{a}tze. Note the one-to-one correspondence between the 2-cells and 3-cells for CFG rewrites and terminals.\\

In more detail, one aspect of rewrite systems we adapt for now is the distinction between terminal and nonterminal symbols; terminal symbols are those after which no further rewrites are possible. We capture this string-diagrammatically by modelling terminal rewrites as 2-cells with target equal to the 1-cell identity of the 0-cell $\star$, which amounts to graphically terminating a wire. The generators subscripted $L$ (for \emph{label} or \emph{leaf}) correspond to terminals of the CFG, and represent a family of generators indexed by a lexicon for the language. The generators subscripted $i$ (for introducing a type) correspond to rewrites of the CFG.
}
\end{figure}

\clearpage

\begin{figure}[h!]
\[\scalebox{0.6}{\tikzfig{tree2gate/tag/tagsignature}}\]
\caption{TAG signature of \texttt{Alice sees Bob quickly run to school}. The \hl{highlighted 2-cells} are auxiliary trees that replace CFG 2-cells for verbs with sentential complement, adverbs, and adpositions. The \hl{highlighted 3-cells} are the tree adjoining operations of the auxiliary trees. The construction yields as a corollary an alternate proof of Theorem 6.1.1 of \citep{joshi_introduction_1987} that recovers CFGs as TAGs.
\begin{corollary}
For every context-free grammar $\mathfrak{G}$ there exists a tree-adjoining grammar $\mathfrak{G}'$ such that $\mathfrak{G}$ and $\mathfrak{G}'$ are strongly equivalent -- both formalisms generate the same set of strings (weak equivalence) and the same abstract syntactic structures (in this case, trees) behind the strings (strong equivalence).
\begin{proof}
Proposition \ref{prop:cfgastag1} provides one direction of both equivalences. For the other direction, we have to show that each auxiliary tree (a 2-cell) and its adjoining operation (a 3-cell) in $\mathfrak{G}'$ corresponds to a single 2-cell tree of some CFG signature $\mathfrak{G}$, which we demonstrate by construction. The highlighted 3-cells of $\mathfrak{G}'$ are obtained systematically from the auxiliary 2-cells as follows: the root and foot nodes $\texttt{X},\texttt{X}^\star$ indicate which wire-type to take as the identity in the left of the 3-cell, and the right of the 3-cell is obtained by replacing all non-$\texttt{X}$ open wires $\texttt{Y}$ with their leaf-ansatzes $\texttt{Y}^\downarrow$. This establishes a correspondence between any 2-cells of $\mathfrak{G}$ considered as auxiliary trees in $\mathfrak{G}'$.
\end{proof}
\end{corollary}}
\end{figure}
\clearpage

\newpage

\begin{figure}[h!]
\[\resizebox{0.75\textwidth}{!}{\tikzfig{tree2gate/cfg/bigcfgbreakdown}}\]
\caption{Reading the central diagram in the main body from left-to-right, we additionally depict the breakdown of the complete derivation in terms of the constitituent 2-cells, and the source and target 1-cells. Evidently, all context-sensitive grammars may be viewed as finitely presented 1-object-2-categories by considering multi-input-multi-output rewrites. More broadly, any string rewriting system is recoverable in the presence of higher dimensional cells. My source for that is that I made a Turing machine in \texttt{homotopy.io} and executed busy-beaver on it as a homework exercise when Jamie Vicary taught Categorical Quantum Mechanics at Oxford.}
\end{figure}
\clearpage
\newpage

\subsection{Tree adjoining grammars with local constraints}

\marginnote{
\begin{defn}[TAG with local constraints: CS-style] [Joshi]
$G = (I,A)$ is a TAG with local constraints if for each node $n$ and each tree $t$, exactly one of the following constraints is specified:
\begin{enumerate}
\item{Selective adjoining (SA): Only a specified subset $\bar{\beta} \subseteq A$ of all auxiliary trees are adjoinable at $n$.}
\item{Null adjoining (NA): No auxiliary tree is adjoinable at the node $n$.}
\item{Obligatory Adjoining (OA): At least one out of all the auxiliary trees adjoinable at $n$ must be adjoined at $n$.}
\end{enumerate}
\end{defn}
}

The usual conception of TAGs includes two extensions to the basic definition presented above. First, there may be \emph{local constraints} on adjoining, which only allows certain trees to be adjoined at certain nodes. Second, TAGs may have links, which are extra edges between nodes obeying a c-command condition. Here we deal with local constraints; dealing with links requires the introduction of braiding.

The $n$-categorical approach easily accommodates local constraints. For (SA), whereas before we take the source of adjoining rewrites to be identities, we can instead introduce ansatz endomorphisms that are rewritable to the desired subsets. For (NA), we assert that identities have no rewrites (NA). For (OA), we can make a distinction between finished and unfinished derivations, where we require that unfinished derivations are precisely those that still contain an obligatory-rewrite endomorphism.

\begin{figure}[h!]
\centering
\[\resizebox{\textwidth}{!}{\tikzfig{tree2gate/tag/ex25}}\]
\caption{
Selective and null adjoining diagrammatically: a reproduction of Example 2.5 of [Joshi] which demonstrates the usage of selective and null adjoining. The notation from [Joshi] is presented first, followed by their corresponding representations in an $n$-categorical signature. The initial tree is presented as a 2-cell where the (SA) rules are rewritable nodes, that serve as sources of rewrites in the 3-cell presentations of the auxiliary trees.
}
\end{figure}

\begin{figure}[h!]
\centering
\[\resizebox{\textwidth}{!}{\tikzfig{tree2gate/tag/ex211}}\]
\caption{
Obligatory adjoining diagrammatically: a reproduction of Example 2.11 of [Joshi] which demonstrates the usage of obligatory adjoining, marked orange. The notation from [Joshi] is presented first, followed by their corresponding representations in an $n$-categorical signature. The initial tree is presented as a 2-cell where the (OA) rule is given its own 2-cell, which is the source of rewrites in 3-cell presentations of auxiliary trees. We may capture the obligatory nature of the rewrite by asking that finished derivations contain no instance of the orange 2-cell. Such global acceptance conditions are hacky but common, and in this case it is efficiently verifiable that diagrams do not contain certain generators.
}
\end{figure}



\subsection{Braiding, symmetries, and suspension}

Before we can model TAGs with links, we must introduce the concepts of braiding and symmetries, which we have seen in the diagrammatic setting already as wires twisting past one another. In our current setting of 1-object-3-categories for TAGs, the diagrams we are dealing with are all planar -- i.e. wires may not cross -- but this is a restriction we must overcome when we are dealing with links.\\

First we observe that in a 1-object-2-categorical setting, a morphism from the identity $\varepsilon$ on the base object $\star$ to itself would, in our analogy with string-rewrite systems, be a rewrite from the empty string to itself. For example, a rewrite $R$ may introduce a symbol from the empty string and then delete it. A rewrite $S$ may create a pair of symbols from nothing and then annihilate them.

\[R := \varepsilon \mapsto x \mapsto \varepsilon \quad\quad\quad\quad S := \varepsilon \mapsto a \cdot b \mapsto \varepsilon\]

\begin{figure}[h!]
\centering
\[\resizebox{\textwidth}{!}{\tikzfig{ncat/xab}}\]
\caption{
In our analogy with string rewrite systems, we might like that the following rewrites are equivalent, while respecting that they are not equal, representing $x,a,b$ as blue, red, and green wires respectively. Such rewrites from the empty string to itself are more generally called \emph{scalars} in the monoidal setting, viewed 2-categorically.
}
\end{figure}

\begin{figure}
\centering
\[\resizebox{\textwidth}{!}{\tikzfig{ncat/eckhilt2}}\]
\caption{We may generally represent such scalars as labelled dots. A fact about scalars in a 1-object-2-category called the Eckmann-Hilton argument is that dots may circle around one another, and all of those expressions are equivalent up to homotopy. The mechanism that enables this in our setting is that the empty string is equal to copies of itself, which creates the necessary space for manoeuvering; translating into the $n$-categorical setting, expressions are equivalent up to introducing and contracting identities.}
\end{figure}

\begin{figure}[h!]
\centering
\[\resizebox{\textwidth}{!}{\tikzfig{ncat/braidstogether}}\]
\caption{We may view the homotopies that get us from one rewrite to another as 3-cells, which produces a braid in a pair of wires when viewed as a vignette. Up to processive isotopies, which are continuous bijective transformations that don't let wires double back on themselves, we can identify two different braidings that are not continuously deformable to one another in the 3-dimensional space of the vignette. We distinguish the braidings visually by letting wires either go over or under one another.}
\end{figure}

\newpage

Now we have a setting in which we can consider wires swapping places. However, having two different ways to swap wires presents a complication. While useful for knot theory, in symmetric monoidal categories we don't want this distinction. Perhaps surprisingly, this distinction is eliminated if we consider swapping dots in the 3D volume rather than the 2D plane. Now we have to extend our analogy to reach 1-object-4-categories. Just as symbols on a 1D string were encoded as 1-cells on the 0-cell identity initially, our braidings are the behaviour of symbols on the 2D plane, encoded as 2-cells on the 1-cell identity of the 0-cell. So, to obtain symbols in a 3D volume, we want 3-cells on the 2-cell identity of the 1-cell identity of the 0-cell. That is a mouthful, so we instead clumsily denote the stacked identity as $\textbf{1}_{\textbf{1}_\star}$. To obtain a dot in a 3-dimensional volume, we consider a rewrite from $\textbf{1}_{\textbf{1}_\star}$ to itself. These dots also enjoy a version of the Eckmann-Hilton argument in 3 dimensions (which holds for all dimensions 2 and higher).

\begin{figure}[h!]
\centering
\[\resizebox{\textwidth}{!}{\tikzfig{ncat/cubes}}\]
\caption{We can depict these swaps by movements in a cubic volume where each axis corresponds to a direction of composition. Whereas on the plane the dots have two ways to swap places -- clockwise and counterclockwise rotation -- in the volume they have two new ways to swap places -- clockwise and counterclockwise in the new dimension. Shown below are two ways to swap left-to-right sequentially composed dots by clockwise rotations in the forward-backward and up-down directions of composition:}
\end{figure}

Considering these changes of dot positions in 3D as a 4D vignette gives us braidings again. But this time, they are equivalent up to processive isotopy -- in other words, any two ways of swapping the dots in the volume are continuously deformable to one another in the 4-dimensional space of the vignette. The reason is intuitive: a clockwise and counterclockwise braiding along one composition axis can be mutually deformed by making use of the extra available axis of composition. So we have eliminated the differences between the two kinds of braidings.\\

To recap: We follow the convention that object dimensions start at 0. In a 1-object-2-category we obtain planar string diagrams for monoidal categories, which are equivalent up to processive isotopies in an ambient 2-dimensional space. In a ($1 \times$ 0-cell)-($1\times$ 1-cell)-3-category, we obtain string diagrams for braided monoidal categories that are equivalent up to processive isotopy in an ambient 3-dimensional space -- the page with depth. In a ($1\times 0$,$1\times 1$,$1\times 2$)-4 category, we obtain string diagrams for symmetric monoidal categories, which are equivalent up to processive isotopies in an ambient 4-dimensional space -- while it is difficult to visualise 4-dimensionally, diagrammatically this simplifies dramatically to just allowing wires to cross and only caring about whether input-output connectivity from left to right makes sense. Now observe that for any 1-object-2-category, we can obtain a ($1\times 0$,$1\times 1$,$1\times 2$)-4 category by promoting all 2-cells and higher to sit on top of $\textbf{1}_{\textbf{1}_\star}$.

\begin{figure}[h!]
\centering
\[\scalebox{0.5}{\tikzfig{tree2gate/cfg/cfgsigtwists}}\]
\caption{For example, taking our CFG signature from earlier, suspension promotes 1-cells to 3-cells and 2-cells to 4-cells. The resulting signature gives us the same diagrams, now with the added ability to consider diagrams equivalent up to twisting wires, which models a string-rewrite system with free swapping of symbol order.}
\end{figure}

In general, the process of going from an $n$-category to an $(n + 1)$-category with just one 0-cell is called \emph{suspension}. So we have essentially that suspending the combinatorial data of planar string diagrams gives braidings, and suspending again gives symmetric monoidal twists: by appropriately suspending the signature, we power up planar diagrams to permit twisting wires.\\

\begin{remark}[\textbf{THE IMPORTANT TAKEAWAY!}]
Now have a combinatoric way to specify string diagrams (that generalises PROPs, modulo weak interchange) for symmetric monoidal categories, which in addition permits us to reason with directed diagram rewrites. So we have a trinity of presentations of the same mathematical concept. String diagrams are the \emph{syntax}. Symmetric monoidal categories are the \emph{semantics}. $n$-categories are the \emph{finite combinatoric presentation} of theories and rewrite systems upon them. By analogy, $n$-categories provide a \emph{vocabulary} and \emph{rewrites} for string-diagram \emph{expressions}, which are interpreted with respect to the \emph{context} of a symmetric monoidal category.
\end{remark}

\subsection{TAGs with links}

\marginnote{
\begin{defn}[TAGs with links: CS-style]
The following is a reproduction of the discussion on nodes with links from [Joshi]. Linking can be defined for any two nodes in an elementary tree. However, in the linguistic context we will require the following conditions to hold for a link in an elementary tree. If a node $n_1$ is linked to a node $n_2$ then:
\begin{enumerate}
\item{$n_2$ \emph{c-commands} $n_1$, (i.e., $n_2$ is not an ancestor of $n_1$, and there exists a node $m$ which is the immediate parent node of $n_2$, and an ancestor of $n_1$).}
\item{$n_1$ and $n_2$ have the same label.}
\item{$n_1$ is the parent only of a null string, or terminal symbols.}
\end{enumerate}
A \emph{TAG with links} is a TAG in which some of the elementary trees may have links as defined above.
\end{defn}
}

Now we have enough to spell out full TAGs with local constraints and links as an $n$-categorical signature. To recap briefly, we have seen that we can model the passage from CFGs to TAGs in the $n$-categorical setting, and then how selective and null adjoining rules by specifying endomorphisms on wires as the source of rewrites, and finally that we can model links in the symmetric monoidal setting. Maintaining planarity (which is important for a left-to-right order of terminals for spelling out a language) and modelling obligatory rewrites can be done by requiring that \emph{finished} derivations are precisely those whose only twists are link-wires, and have no sources for obligatory adjoins.

\begin{example}
The following is a reproduction in \texttt{homotopy.io} of Example 2.4 of [Joshi], illustrating TAGs with links; as a proof assistant for weak $n$-categories, \texttt{homotopy.io} automatically performs tree adjunction after the signature has been properly spelled out.

\begin{figure}[h!]
\centering
\[\resizebox{\textwidth}{!}{\tikzfig{tree2gate/tag/joshiex24}}\]
\[\resizebox{\textwidth}{!}{\tikzfig{tree2gate/tag/joshiex241}}\]
\caption{TAG signature and example derivation. Joshi stresses that adjoining \emph{preserves} links, and that elementary trees may become \emph{stretched} in the process of derivation, which are fundamentally topological constraints, akin to the "only (processive) connectivity matters" criterion identifying string diagrams up to isomorphism. Moreover, TAGs evidently have links of two natures: tree edges intended to be planar, and dashed dependency edges intended to freely cross over tree edges. It is easy, but a hack, to ask for planar processive isomorphisms for tree edges and extraplanar behaviour for dependency edges: these are evidently two different kinds of structure glued together, rather than facets of some whole. Weak $n$-categories offer a unified mathematical framework that natively accommodates the desired topological constraints while also granting expressive control over wire-types of differing behaviours. One method to recover TAGs true to the original conception is to stay in a planar 1-object-2-category setting while explicitly including wire-crossing cells for dependency links. The alternative method we opt for in Section \ref{sec:gencirc} is to work in a pure "only connectivity matters" setting, recovering the linear ordering of words by generating cells along a chosen wire. I do not know of any conceptual justification for why planarity is so often an implicit constraint in approaches to formal syntax. My best guesses are either that the first port of call for rewrites between 1-dimensional strings of words is a 2-dimensional setting, or it is a limitation of 2-dimensional paper as a medium of thought along with some confusion of map for territory.}
\end{figure}

\begin{figure}[h!]
\centering
\[\vcenter{\hbox{\resizebox{0.1\textwidth}{!}{\input{figures/tree2gate/tag/ex24.tikz}}}} \overset{\beta_1}{\rightarrow} \quad \vcenter{\hbox{\resizebox{0.3\textwidth}{!}{\input{figures/tree2gate/tag/ex242.tikz}}}} \overset{\beta_1}{\rightarrow} \quad \vcenter{\hbox{\resizebox{0.5\textwidth}{!}{\input{figures/tree2gate/tag/ex243.tikz}}}}\]
\caption{With our interpretation of TAGS as weak $n$-categorical signatures, We can recover each step of the same example derivation automagically in \texttt{homotopy.io}; just clicking on where we want rewrites allows the proof assistant to execute a typematching tree adjunction. In the process of interpretation, we introduce a link wire-type (in purple), and include directed link generation and elimination morphisms for the $T$ wire-type (in blue). A necessary step in the process of interpretation (which for us involves taking a Poincar\'{e} dual to interpret nodes as wires) is a typing assignment of the tree-branches connected to terminal nodes, which we have opted to read as sharing a $T$-type for minimality, though we could just as well have introduced a separate label-type wire.}
\end{figure}

\begin{figure}[h!]
\centering
\[\overset{\beta_2}{\rightarrow} \vcenter{\hbox{\resizebox{0.9\textwidth}{!}{\input{figures/tree2gate/tag/ex244.tikz}}}}\]
\caption{The intended takeaway is that even if you don't buy the necessity or formality of weak $n$-categories, there is always the fallback epistemic underpinning of a formal proof assistant for higher dimensional rewriting theories, which is rather simple to use if I have succeeded in communicating higher-dimensional intuitions in this section. \textbf{N.B.} In practice when using \texttt{homotopy.io} for the symmetric monoidal setting, it is simpler to suspend symmetric monoidal signatures to begin at 4-cells rather than 3-cells. The reason for this is that under- and over-braids still exist in the symmetric monoidal setting, and while sequentially composed braids are homotopically equivalent to the pair of identities, they are not uniquely so, thus these homotopies must be input manually. By beginning at 4-cells (or higher, due to the stabilisation hypothesis \citep{nlab_authors_stabilization_nodate}), braid-eliminations are unique up to homotopy and can be performed more easily in the proof assistant.}
\end{figure}
\end{example}

\clearpage

\subsection{Full TAGs in weak $n$-categories}

I apologise in advance for the sheer ugliness of the following construction. Partly this is inevitable for combinatorial data, but the diagrammatic signatures also present combinatorial data and are easier to read, so what gives? This is what happens when one defines mathematical objects outside of their natural habitat. The native habitat of TAGs is diagrammatic, to accommodate a natural and spatially-intuitive generalisation of context-free grammars by allowing trees to be adjoined on nodes other than the leaves. I consider the offensiveness of the translation to follow a direct measure of the wrongness of linear-symbolic foundations, and an example of the harm that results from the prejudice that pictures cannot be formal.

\begin{myboxB}
\begin{multicols}{2}
\begin{defn}[Linguistic Tree Adjoining Grammars] A \emph{Linguistic Tree Adjoining Grammar} is given by the following data:

\[(\mathcal{N}, \mathcal{N}^\downarrow, \mathcal{N}^*, \Sigma, \mathcal{I}, \mathcal{A}, \mathfrak{S} \subseteq \mathcal{P}(\mathcal{A}), \Box, \Diamond, \mathfrak{L} \subseteq \mathcal{N})\]

The initial elements are the same as an elementary tree-adjoining grammar and obey the same constraints. The modifications are:

\begin{itemize}
\item{$\mathcal{I}$ is a nonempty set of \emph{initial} constrained-linked-trees.}
\item{$\mathcal{A}$ is a nonempty set of \emph{auxiliary} constrained-linked-trees.}
\item{$\mathfrak{S}$ is a set of sets of \emph{select} auxiliary trees.}
\item{$\Box, \Diamond$ are fresh symbols. $\Box$ marks \emph{obligatory adjoins}, and $\Diamond$ marks \emph{optional} adjoins.}
\item{$\mathfrak{L}$ is a set permissible \emph{link types} among nonterminals or $\top$.}
\end{itemize}
A \emph{constrained-linked-tree}, or CL-tree, is a pair consisting of:
\begin{itemize}
\item{A tree where each internal node is an element of $\mathcal{N} \times \mathfrak{S} \times \{\Box,\Diamond\} \times \{*, \bar{*}\}$, and each leaf is an element of $\mathcal{N} \times \mathfrak{S} \times \{\Box,\Diamond\} \times \{*, \bar{*}\} \cup \Sigma$. In prose, each label is either a terminal symbol (as a leaf), or otherwise a nonterminal, along with a subset of auxiliary trees that indicates select adjoins (or null-adjoins when the subset is $\varnothing$), a marker indicating whether those adjoins are obligatory or optional, and a marker indicating whether the node is a foot node or not. Observe that there is no need to indicate when a node is a valid target for substitution since that function is subsumed by null adjoining rules.}
\item{
A set of ordered pairs of nodes $(n_1,n_2)$ of the tree such that:
\begin{enumerate}
\item{$n_2$ \emph{c-commands} $n_1$, (i.e., $n_2$ is not an ancestor of $n_1$, and there exists a node $m$ which is the immediate parent node of $n_2$, and an ancestor of $n_1$).}
\item{$n_1$ and $n_2$ share the same type $\mathbf{T} \in \mathcal{N}$ and $\mathbf{T} \in \mathfrak{L}$, or both $n_1,n_2$ are terminals.}
\item{$n_1$ is the parent of terminal symbols, or childless.}
\end{enumerate}
}
\end{itemize}
\end{defn}
\end{multicols}
\end{myboxB}

\begin{myboxB}
\begin{multicols}{2}
\begin{construction}[TAGs in \texttt{homotopy.io}]
We spell out how the data of a TAG becomes an $n$-categorical signature by enumerating cell dimensions:

\begin{enumerate}
\setcounter{enumi}{-1}
\item{A single object $\star$}
\item{None.}
\item{None.}
\item{
	\begin{itemize}
	\item{For each $\mathbf{T} \in \mathcal{N}$, a cell $\mathbf{T}: \mathbf{1}_{\mathbf{1}_\star} \rightarrow \mathbf{1}_{\mathbf{1}_\star}$.}
	\item{$\top: \mathbf{1}_{\mathbf{1}_\star} \rightarrow \mathbf{1}_{\mathbf{1}_\star}$ A wire for terminal symbols.}
	\item{For each $\mathbf{L} \in \mathfrak{L}$, a cell $\mathbf{L} : \mathbf{1}_{\mathbf{1}_\star} \rightarrow \mathbf{1}_{\mathbf{1}_\star}$.}
	\end{itemize}
}
\item{
	We distinguish between \emph{atomic} and \emph{composite} generators at this level. The trees themselves are composites of \emph{atomic} generators. The \emph{atomic} generators are:
	\begin{itemize}
	\item{For each node $n$ that occurs in either $\mathcal{I}$ or $\mathcal{A}$, we populate cells by a case analysis:
	\begin{itemize}
		\item{If $n$ is a terminal $\sigma \in \Sigma$, we create a cell $\sigma: \top \rightarrow \mathbf{1}_{\mathbf{1}_{\mathbf{1}_\star}}$.}
		\item{Where $\phi \in \mathfrak{S}$ denotes a selective adjoining rule where required, if $n = (\mathbf{T},\mathbf{S},\dagger,\bar{*})$, we create $\phi\mathbf{S}_\mathbf{T}^\Box: \mathbf{T} \rightarrow \mathbf{T}$ if the node is marked obligatory ($\dagger = \Box$), and a cell $\phi\mathbf{S}_\mathbf{T}^\Diamond: \mathbf{T} \rightarrow \mathbf{T}$ otherwise.}
		\item{If $n = (\mathbf{T},\mathbf{S},\dagger,*)$, it is a foot node, for which we create a cell $\mathbf{S}_\mathbf{T}^\Box: \mathbf{T} \rightarrow \mathbf{1}_{\mathbf{1}_{\mathbf{1}_\star}}$ if the node is marked obligatory ($\dagger = \Box$), and a cell $\mathbf{S}_\mathbf{T}^\Diamond: \mathbf{T} \rightarrow \mathbf{1}_{\mathbf{1}_{\mathbf{1}_\star}}$ otherwise.}
	\end{itemize}
	}
	\item{For each $\mathbf{L} \in \mathfrak{L}$ (which is also a type $\mathbf{T} \in \mathcal{N}$) a pair of cells $\mathbf{T}^\mathbf{L} : \mathbf{T} \rightarrow \mathbf{T} \otimes \mathbf{L}$ and $\mathbf{T}_\mathbf{L} : \mathbf{L} \otimes \mathbf{T} \rightarrow \mathbf{T}$.}
	\item{For each node $p$ of type $\mathbf{T}_p$ in either $\mathcal{I}$ or $\mathcal{A}$ with a nonempty left-to-right list of children $C_p := \left<c_1,c_2,\cdots c_i, c\dots c_n \right>$ with types $\mathbf{T}_i$, a branch cell $C_p : \mathbf{T}_p \rightarrow \bigotimes\limits_{i=1}^{n} \mathbf{T}_i$.}
	\end{itemize}
	We represent trees by composite generators, defined recursively. For a given tree $\mathcal{T}$ in either $\mathcal{I}$ or $\mathcal{A}$, we define a composite generator beginning at the root. Where the root node is $p = (\mathbf{T},\mathbf{S},\dagger)$, we begin with the cell $\mathbf{S}_\mathbf{T}^\dagger$. For branches, we compose the branch cell $C_p$ to this cell sequentially. If $p$ has a child $c$ that has a link, we do a case analysis. If that child c-commands the other end of the link we generate the first half of the linking wire by composing $\mathbf{T}^\mathbf{L}$ for the appropriate type $\mathbf{T}$ of the child node. Otherwise the child is c-commanded by a previously generated link, which we braid over and connect using $\mathbf{T}_\mathbf{L}$, again with the appropriate typing for the child. Now we may recurse the procedure for subtrees. If a node has no children, it is a leaf $l = (\mathbf{T},\mathbf{S},\dagger)$ or a terminal symbol. We append a terminal cell $\sigma$ if $l$ is a terminal symbol (thus killing the wire), and otherwise we leave an open $\mathbf{T}$ wire after appending $\mathbf{S}_\mathbf{T}^\dagger$. Altogether this obtains a 3-cell which we denote $\mathcal{T}$, overloading notation; different execution-orders of the above procedure evidently obtain 3-cells equivalent up to homotopy.
}
\item{
For each $\phi\mathbf{S}_\mathbf{T}^\Box$, $\phi\mathbf{S}_\mathbf{T}^\Diamond$, and for each typematching 4-cell tree in the subset of select adjoins of $\phi$, we create a 5-cell rewrite that performs tree adjoining, taking the former to be the source and the latter to be the target.
}
\end{enumerate}
A derivation is finished when there are no obligatory adjoin nodes, all leaves are terminal symbols, and homotopies are applied such that only dependency link-wires participate in braidings, which implies that the tree-part is planar.
\end{construction}
\end{multicols}
\end{myboxB}

\clearpage

